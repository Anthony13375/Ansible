---
- name: Download and extract Apache Kafka
  hosts: my
  become: yes
  vars:
    kafka_version: "4.1.0"
    kafka_scala_version: "2.13"
    install_dir: "/opt/kafka"
    temp_dir: "/opt/distr/kafka_download"
    
  tasks:
    - name: Create temporary directory for download
      file:
        path: "{{ temp_dir }}"
        state: directory
        mode: '0755'
      
    - name: Create installation directory
      file:
        path: "{{ install_dir }}"
        state: directory
        mode: '0755'
      
    - name: Download Apache Kafka
      get_url:
        url: "https://downloads.apache.org/kafka/{{ kafka_version }}/kafka_{{ kafka_scala_version }}-{{ kafka_version }}.tgz"
        dest: "{{ temp_dir }}/kafka.tgz"
        mode: '0644'
      
    - name: Extract Kafka archive
      unarchive:
        src: "{{ temp_dir }}/kafka.tgz"
        dest: "{{ install_dir }}"
        remote_src: yes
        extra_opts: "--strip-components=1"
        creates: "{{ install_dir }}/bin"
